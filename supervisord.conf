[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
user=root

[program:tailscaled]
command=/usr/sbin/tailscaled --state=/var/lib/tailscale/tailscaled.state --tun=userspace-networking
autostart=true
autorestart=true
priority=10

[program:tailscale-up]
command=/bin/sh -c "sleep 10; tailscale up --authkey=${TS_AUTHKEY} --hostname=${TS_HOSTNAME:-hf-vps} ${TS_EXTRA_ARGS} || true"
autostart=true
autorestart=false
priority=11

[program:sshd]
command=/usr/sbin/sshd -D
autostart=true
autorestart=true
priority=20

[program:php-fpm]
# 不写死版本号：bookworm 默认是 8.2，但命令通常是 php-fpm8.2 或 php-fpm
command=/bin/sh -c "if command -v php-fpm8.2 >/dev/null 2>&1; then exec php-fpm8.2 -F; else exec php-fpm -F; fi"
autostart=true
autorestart=true
priority=30

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
priority=40

[program:socks5]
command=/usr/local/bin/microsocks -i 0.0.0.0 -p 1080
autostart=true
autorestart=true
priority=50

[program:periodic-backup]
# 每4小时备份一次
command=/bin/sh -c "while true; do /scripts/backup.sh; sleep 14400; done"
autostart=true
autorestart=true
priority=60
